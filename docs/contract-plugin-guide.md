# 支付宝小程序电子签约插件接入说明

## 配置步骤

### 1. 配置插件信息

在 `manifest.json` 的 `mp-alipay` 配置中添加插件配置：

```json
"mp-alipay": {
    "usingComponents": true,
    "plugins": {
        "signContract": {
            "version": "*",
            "provider": "你的插件ID"  // 请替换为实际的插件ID
        }
    }
}
```

**注意**：请将 `provider` 字段的值替换为您在支付宝开放平台申请的电子签约插件的实际ID。

### 2. 后端接口要求

后端需要提供一个创建签约任务的接口 `/contract/create`，该接口需要：

**请求参数：**
```json
{
    "name": "签约人姓名",
    "idCard": "身份证号",
    "phone": "联系电话",
    "date": "签约日期"
}
```

**返回格式：**
```json
{
    "code": 0,
    "data": {
        "taskId": "签约任务ID"  // 必填，用于调用签约插件
    },
    "message": "成功"
}
```

### 3. 使用说明

签约页面的使用流程：

1. 用户填写签约信息（姓名、身份证号、电话、日期）
2. 点击"提交签约"按钮
3. 系统调用后端接口创建签约任务，获取 `taskId`
4. 调用支付宝电子签约插件进行签约
5. 签约成功后返回上一页

### 4. 插件调用方式

代码中已经实现了两种调用方式的自动切换：

- **方式1**：优先使用 `my.signContract`（支付宝官方API）
- **方式2**：如果官方API不可用，则使用插件API `requirePlugin('signContract')`

### 5. 注意事项

1. **插件ID配置**：请确保在 `manifest.json` 中配置了正确的插件ID
2. **后端接口**：确保后端接口返回的 `taskId` 格式正确
3. **错误处理**：代码中已包含完整的错误处理逻辑
4. **平台限制**：电子签约功能仅在支付宝小程序平台可用

### 6. 测试建议

1. 先在开发环境测试插件配置是否正确
2. 测试后端接口是否正常返回 `taskId`
3. 测试签约流程是否完整
4. 测试错误场景的处理（如网络错误、插件调用失败等）

## 常见问题

### Q: 插件调用失败怎么办？
A: 检查以下几点：
- manifest.json 中的插件ID是否正确
- 插件是否已在小程序后台添加
- taskId 是否有效

### Q: 如何获取签约结果？
A: 签约结果可以通过以下方式获取：
- 签约成功回调（在 success 回调中处理）
- 后端轮询签约状态接口
- 后端接收支付宝的回调通知

### Q: 支持哪些签约类型？
A: 具体支持的签约类型请参考支付宝电子签约插件的官方文档。

